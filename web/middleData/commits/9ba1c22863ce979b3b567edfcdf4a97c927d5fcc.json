{"sha":"9ba1c22863ce979b3b567edfcdf4a97c927d5fcc","commit":{"author":{"name":"Vitalii Parfonov","email":"vparfonov@codenvy.com","date":"2017-05-18T09:09:54Z"},"committer":{"name":"GitHub","email":"noreply@github.com","date":"2017-05-18T09:09:54Z"},"message":"One more fix for avoid NPE (#5121)\n\nSigned-off-by: Vitalii Parfonov <vparfonov@codenvy.com>","tree":{"sha":"59b7d02b3fba34e033200a4f9fdc21c13e1ff6d4","url":"https://api.github.com/repos/eclipse/che/git/trees/59b7d02b3fba34e033200a4f9fdc21c13e1ff6d4"},"url":"https://api.github.com/repos/eclipse/che/git/commits/9ba1c22863ce979b3b567edfcdf4a97c927d5fcc","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/eclipse/che/commits/9ba1c22863ce979b3b567edfcdf4a97c927d5fcc","html_url":"https://github.com/eclipse/che/commit/9ba1c22863ce979b3b567edfcdf4a97c927d5fcc","comments_url":"https://api.github.com/repos/eclipse/che/commits/9ba1c22863ce979b3b567edfcdf4a97c927d5fcc/comments","author":{"login":"vparfonov","id":1636592,"avatar_url":"https://avatars1.githubusercontent.com/u/1636592?v=4","gravatar_id":"","url":"https://api.github.com/users/vparfonov","html_url":"https://github.com/vparfonov","followers_url":"https://api.github.com/users/vparfonov/followers","following_url":"https://api.github.com/users/vparfonov/following{/other_user}","gists_url":"https://api.github.com/users/vparfonov/gists{/gist_id}","starred_url":"https://api.github.com/users/vparfonov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vparfonov/subscriptions","organizations_url":"https://api.github.com/users/vparfonov/orgs","repos_url":"https://api.github.com/users/vparfonov/repos","events_url":"https://api.github.com/users/vparfonov/events{/privacy}","received_events_url":"https://api.github.com/users/vparfonov/received_events","type":"User","site_admin":false},"committer":{"login":"web-flow","id":19864447,"avatar_url":"https://avatars3.githubusercontent.com/u/19864447?v=4","gravatar_id":"","url":"https://api.github.com/users/web-flow","html_url":"https://github.com/web-flow","followers_url":"https://api.github.com/users/web-flow/followers","following_url":"https://api.github.com/users/web-flow/following{/other_user}","gists_url":"https://api.github.com/users/web-flow/gists{/gist_id}","starred_url":"https://api.github.com/users/web-flow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/web-flow/subscriptions","organizations_url":"https://api.github.com/users/web-flow/orgs","repos_url":"https://api.github.com/users/web-flow/repos","events_url":"https://api.github.com/users/web-flow/events{/privacy}","received_events_url":"https://api.github.com/users/web-flow/received_events","type":"User","site_admin":false},"parents":[{"sha":"802604552eb18313806325f02956027a68eb96d4","url":"https://api.github.com/repos/eclipse/che/commits/802604552eb18313806325f02956027a68eb96d4","html_url":"https://github.com/eclipse/che/commit/802604552eb18313806325f02956027a68eb96d4"}],"stats":{"total":31,"additions":17,"deletions":14},"files":[{"sha":"33ca6848c7b91a4fd74a11d9a765680fb516588d","filename":"wsagent/che-core-api-project/src/main/java/org/eclipse/che/api/vfs/watcher/FileWatcherService.java","status":"modified","additions":17,"deletions":14,"changes":31,"blob_url":"https://github.com/eclipse/che/blob/9ba1c22863ce979b3b567edfcdf4a97c927d5fcc/wsagent/che-core-api-project/src/main/java/org/eclipse/che/api/vfs/watcher/FileWatcherService.java","raw_url":"https://github.com/eclipse/che/raw/9ba1c22863ce979b3b567edfcdf4a97c927d5fcc/wsagent/che-core-api-project/src/main/java/org/eclipse/che/api/vfs/watcher/FileWatcherService.java","contents_url":"https://api.github.com/repos/eclipse/che/contents/wsagent/che-core-api-project/src/main/java/org/eclipse/che/api/vfs/watcher/FileWatcherService.java?ref=9ba1c22863ce979b3b567edfcdf4a97c927d5fcc","patch":"@@ -169,7 +169,7 @@ void stop() {\n         }\n     }\n \n-    boolean isStopped(){\n+    boolean isStopped() {\n         return executor.isShutdown();\n     }\n \n@@ -186,21 +186,23 @@ boolean isStopped(){\n      *         directory\n      */\n     public void register(Path dir) {\n+        if (!Files.exists(dir)) {\n+            LOG.debug(\"Trying to register directory '{}' but it does not exist\", dir);\n+            return;\n+        }\n         LOG.debug(\"Registering directory '{}'\", dir);\n         if (keys.values().contains(dir)) {\n             int previous = registrations.get(dir);\n             LOG.debug(\"Directory is already being watched, increasing watch counter, previous value: {}\", previous);\n             registrations.put(dir, previous + 1);\n         } else {\n-            if (Files.exists(dir)) {\n-                try {\n-                    LOG.debug(\"Starting watching directory '{}'\", dir);\n-                    WatchKey watchKey = dir.register(service, eventKinds, eventModifiers);\n-                    keys.put(watchKey, dir);\n-                    registrations.put(dir, 1);\n-                } catch (IOException e) {\n-                    LOG.error(\"Can't register dir {} in file watch service\", dir, e);\n-                }\n+            try {\n+                LOG.debug(\"Starting watching directory '{}'\", dir);\n+                WatchKey watchKey = dir.register(service, eventKinds, eventModifiers);\n+                keys.put(watchKey, dir);\n+                registrations.put(dir, 1);\n+            } catch (IOException e) {\n+                LOG.error(\"Can't register dir {} in file watch service\", dir, e);\n             }\n         }\n     }\n@@ -210,9 +212,9 @@ public void register(Path dir) {\n      * method decreases by one registration counter that corresponds to\n      * directory specified by the argument. If registration counter comes to\n      * zero directory watching is totally cancelled.\n-     *\n+     * <p>\n      * If this method is called for not existing directory nothing happens.\n-     *\n+     * <p>\n      * If this method is called for not registered directory nothing happens.\n      *\n      * @param dir\n@@ -324,8 +326,9 @@ private void run() {\n \n     private void resetAndRemove(WatchKey watchKey, Path dir) {\n         if (!watchKey.reset()) {\n-            registrations.remove(dir);\n-\n+            if (dir != null) {\n+                registrations.remove(dir);\n+            }\n             keys.remove(watchKey);\n         }\n     }"}]}
